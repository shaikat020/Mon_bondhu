{% extends 'base.html' %}

{% block content %}
<main class="container mx-auto px-4 py-8">
    <div class="glass-morphism p-8 rounded-3xl">
    <div style="background: white; padding: 2rem; border-radius: 15px; margin: 2rem 0;">
        <h2 style="color: #4a5568; margin-bottom: 1rem;">üìä ‡¶∏‡ßç‡¶¨‡¶æ‡¶∏‡ßç‡¶•‡ßç‡¶Ø ‡¶°‡ßá‡¶ü‡¶æ ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü</h2>
        <p style="color: #718096; margin-bottom: 2rem;">‡¶è‡¶®‡¶ú‡¶ø‡¶ì ‡¶ì ‡¶∏‡ßç‡¶¨‡¶æ‡¶∏‡ßç‡¶•‡ßç‡¶Ø ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ó‡ßã‡¶™‡¶®‡ßÄ‡¶Ø‡¶º‡¶§‡¶æ ‡¶∞‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∏‡¶æ‡¶Æ‡¶ó‡ßç‡¶∞‡¶ø‡¶ï ‡¶°‡ßá‡¶ü‡¶æ ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü</p>
        
        <!-- Privacy Notice -->
        <div style="background: #e6fffa; border: 1px solid #b2f5ea; padding: 1.5rem; border-radius: 10px; margin-bottom: 2rem;">
            <h4 style="color: #234e52; margin-bottom: 0.5rem;">üîí ‡¶ó‡ßã‡¶™‡¶®‡ßÄ‡¶Ø‡¶º‡¶§‡¶æ ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§</h4>
            <p style="color: #234e52; margin: 0;">
                <strong>‡¶ï‡ßã‡¶® ‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø‡¶ó‡¶§ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º ‡¶®‡¶æ‡•§</strong> ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶∏‡¶æ‡¶Æ‡¶ó‡ßç‡¶∞‡¶ø‡¶ï ‡¶™‡¶∞‡¶ø‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶® (Aggregated Data) 
                ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º ‡¶Ø‡¶æ ‡¶•‡ßá‡¶ï‡ßá ‡¶ï‡ßã‡¶® ‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø‡¶ï‡ßá ‡¶ö‡¶ø‡¶π‡ßç‡¶®‡¶ø‡¶§ ‡¶ï‡¶∞‡¶æ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶®‡¶Ø‡¶º‡•§
            </p>
        </div>

        <!-- Data Overview -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 3rem;">
            <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 1.5rem; border-radius: 10px; text-align: center;">
                <div style="font-size: 2rem;" id="totalCheckins">‡ß¶</div>
                <div>‡¶Æ‡ßã‡¶ü ‡¶Æ‡ßÅ‡¶° ‡¶ö‡ßá‡¶ï-‡¶á‡¶®</div>
            </div>
            <div style="background: linear-gradient(135deg, #f093fb, #f5576c); color: white; padding: 1.5rem; border-radius: 10px; text-align: center;">
                <div style="font-size: 2rem;" id="helpRequests">‡ß¶</div>
                <div>‡¶∏‡¶æ‡¶π‡¶æ‡¶Ø‡ßç‡¶Ø ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß</div>
            </div>
            <div style="background: linear-gradient(135deg, #4facfe, #00f2fe); color: white; padding: 1.5rem; border-radius: 10px; text-align: center;">
                <div style="font-size: 2rem;" id="activeUsers">‡ß¶</div>
                <div>‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ</div>
            </div>
            <div style="background: linear-gradient(135deg, #43e97b, #38f9d7); color: white; padding: 1.5rem; border-radius: 10px; text-align: center;">
                <div style="font-size: 2rem;" id="topContent">‡ß¶</div>
                <div>‡¶∏‡¶∞‡ßç‡¶¨‡¶æ‡¶ß‡¶ø‡¶ï ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü</div>
            </div>
        </div>

        <!-- Export Options -->
        <div style="background: #f7fafc; padding: 2rem; border-radius: 10px; margin-bottom: 2rem;">
            <h3 style="color: #4a5568; margin-bottom: 1rem;">üì§ ‡¶°‡ßá‡¶ü‡¶æ ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                <div style="background: white; padding: 1.5rem; border-radius: 10px; text-align: center;">
                    <div style="font-size: 2rem; margin-bottom: 1rem;">üìä</div>
                    <h4 style="color: #2d3748; margin-bottom: 0.5rem;">‡¶∏‡¶æ‡¶Æ‡¶ó‡ßç‡¶∞‡¶ø‡¶ï ‡¶™‡¶∞‡¶ø‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶®</h4>
                    <p style="color: #718096; margin-bottom: 1rem;">‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞, ‡¶ö‡ßá‡¶ï-‡¶á‡¶®, ‡¶è‡¶¨‡¶Ç engagement ‡¶°‡ßá‡¶ü‡¶æ</p>
                    <button class="btn" style="background: #667eea; color: white; width: 100%;" 
                            onclick="exportData('overview')">
                        JSON ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü
                    </button>
                </div>
                
                <div style="background: white; padding: 1.5rem; border-radius: 10px; text-align: center;">
                    <div style="font-size: 2rem; margin-bottom: 1rem;">üó∫Ô∏è</div>
                    <h4 style="color: #2d3748; margin-bottom: 0.5rem;">‡¶è‡¶≤‡¶æ‡¶ï‡¶æ ‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶ï ‡¶°‡ßá‡¶ü‡¶æ</h4>
                    <p style="color: #718096; margin-bottom: 1rem;">‡¶á‡¶â‡¶®‡¶ø‡¶Ø‡¶º‡¶® ‡¶ì ‡¶â‡¶™‡¶ú‡ßá‡¶≤‡¶æ ‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶ï ‡¶∏‡¶æ‡¶π‡¶æ‡¶Ø‡ßç‡¶Ø ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß</p>
                    <button class="btn" style="background: #ed8936; color: white; width: 100%;" 
                            onclick="exportData('regional')">
                        CSV ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü
                    </button>
                </div>
                
                <div style="background: white; padding: 1.5rem; border-radius: 10px; text-align: center;">
                    <div style="font-size: 2rem; margin-bottom: 1rem;">üìà</div>
                    <h4 style="color: #2d3748; margin-bottom: 0.5rem;">‡¶ü‡ßç‡¶∞‡ßá‡¶®‡ßç‡¶° ‡¶¨‡¶ø‡¶∂‡ßç‡¶≤‡ßá‡¶∑‡¶£</h4>
                    <p style="color: #718096; margin-bottom: 1rem;">‡¶∏‡¶Æ‡¶Ø‡¶º‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá usage patterns ‡¶è‡¶¨‡¶Ç trends</p>
                    <button class="btn" style="background: #38a169; color: white; width: 100%;" 
                            onclick="exportData('trends')">
                        ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶≤ ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü
                    </button>
                </div>
            </div>

            <!-- Date Range Selector -->
            <div style="background: white; padding: 1.5rem; border-radius: 10px; margin-bottom: 1rem;">
                <h4 style="color: #4a5568; margin-bottom: 1rem;">üìÖ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ range ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 1rem; align-items: end;">
                    <div>
                        <label style="display: block; color: #4a5568; margin-bottom: 0.5rem; font-weight: bold;">
                            ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ
                        </label>
                        <input type="date" id="startDate" 
                               style="width: 100%; padding: 0.75rem; border: 2px solid #e2e8f0; border-radius: 8px;">
                    </div>
                    <div>
                        <label style="display: block; color: #4a5568; margin-bottom: 0.5rem; font-weight: bold;">
                            ‡¶∂‡ßá‡¶∑ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ
                        </label>
                        <input type="date" id="endDate" 
                               style="width: 100%; padding: 0.75rem; border: 2px solid #e2e8f0; border-radius: 8px;">
                    </div>
                    <button class="btn" style="background: #4a5568; color: white; white-space: nowrap;" 
                            onclick="applyDateRange()">
                        ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
                    </button>
                </div>
            </div>
        </div>

        <!-- Data Preview -->
        <div style="background: white; padding: 2rem; border-radius: 10px; margin-bottom: 2rem;">
            <h3 style="color: #4a5568; margin-bottom: 1rem;">üëÅÔ∏è ‡¶°‡ßá‡¶ü‡¶æ ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â</h3>
            <div style="background: #f7fafc; padding: 1.5rem; border-radius: 8px; overflow-x: auto;">
                <pre id="dataPreview" style="margin: 0; font-family: 'Courier New', monospace; font-size: 0.9rem; color: #4a5568;">
‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶â‡¶™‡¶∞‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®...
                </pre>
            </div>
        </div>

        <!-- Usage Guidelines -->
        <div style="background: #fffaf0; border: 1px solid #feebc8; padding: 1.5rem; border-radius: 10px;">
            <h4 style="color: #744210; margin-bottom: 1rem;">üìã ‡¶°‡ßá‡¶ü‡¶æ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ó‡¶æ‡¶á‡¶°‡¶≤‡¶æ‡¶á‡¶®</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                <div>
                    <h5 style="color: #744210; margin-bottom: 0.5rem;">‚úÖ ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶ø‡¶§ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞</h5>
                    <ul style="color: #744210; padding-left: 1rem; margin: 0; font-size: 0.9rem;">
                        <li>‡¶∏‡ßá‡¶¨‡¶æ ‡¶â‡¶®‡ßç‡¶®‡¶Ø‡¶º‡¶® ‡¶ì ‡¶™‡¶∞‡¶ø‡¶ï‡¶≤‡ßç‡¶™‡¶®‡¶æ</li>
                        <li>‡¶§‡¶π‡¶¨‡¶ø‡¶≤ ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶π‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</li>
                        <li>‡¶∏‡ßç‡¶¨‡¶æ‡¶∏‡ßç‡¶•‡ßç‡¶Ø ‡¶ï‡¶∞‡ßç‡¶Æ‡¶∏‡ßÇ‡¶ö‡ßÄ ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®</li>
                        <li>‡¶ó‡¶¨‡ßá‡¶∑‡¶£‡¶æ ‡¶ì ‡¶¨‡¶ø‡¶∂‡ßç‡¶≤‡ßá‡¶∑‡¶£</li>
                    </ul>
                </div>
                <div>
                    <h5 style="color: #744210; margin-bottom: 0.5rem;">‚ùå ‡¶®‡¶ø‡¶∑‡¶ø‡¶¶‡ßç‡¶ß ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞</h5>
                    <ul style="color: #744210; padding-left: 1rem; margin: 0; font-size: 0.9rem;">
                        <li>‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø‡¶ó‡¶§ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∂‡¶®‡¶æ‡¶ï‡ßç‡¶§‡¶ï‡¶∞‡¶£</li>
                        <li>‡¶¨‡¶æ‡¶£‡¶ø‡¶ú‡ßç‡¶Ø‡¶ø‡¶ï ‡¶â‡¶¶‡ßç‡¶¶‡ßá‡¶∂‡ßç‡¶Ø‡ßá ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞</li>
                        <li>‡¶¨‡¶ø‡¶Æ‡¶æ ‡¶ï‡ßç‡¶≤‡ßá‡¶Æ ‡¶¨‡¶æ legal proceedings</li>
                        <li>‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶¶‡ßá‡¶∞ ‡¶ü‡¶æ‡¶∞‡ßç‡¶ó‡ßá‡¶ü‡ßá‡¶° marketing</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    </div>
</main>

<style>
.export-btn {
    background: #667eea;
    color: white;
    border: none;
    padding: 1rem 2rem;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1rem;
    transition: all 0.3s;
    margin: 0.5rem;
}

.export-btn:hover {
    background: #5a67d8;
    transform: translateY(-2px);
}

.data-card {
    background: white;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    padding: 1.5rem;
    margin-bottom: 1rem;
}

.data-card h4 {
    color: #2d3748;
    margin-bottom: 1rem;
}
</style>

<script>
// Sample aggregated data
const sampleData = {
    overview: {
        total_checkins: 1247,
        help_requests: 89,
        active_users: 342,
        top_content: "‡¶°‡ßá‡¶ô‡ßç‡¶ó‡ßÅ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∞‡ßã‡¶ß",
        mood_distribution: {
            happy: 45,
            neutral: 30,
            sad: 15,
            anxious: 8,
            angry: 2
        },
        help_request_types: {
            mental_health: 45,
            physical_health: 28,
            emergency: 12,
            other: 4
        },
        regional_engagement: {
            "‡¶ö‡¶∞ ‡¶ï‡¶≤‡¶æ‡¶™‡¶æ‡¶°‡¶º‡¶æ": 567,
            "‡¶ö‡¶∞‡¶´‡ßç‡¶Ø‡¶æ‡¶∂‡¶® ‡¶∏‡¶¶‡¶∞": 432,
            "‡¶®‡¶õ‡¶∞‡¶§‡¶™‡ßÅ‡¶∞": 248
        }
    },
    regional: {
        upazila_data: [
            {
                upazila: "‡¶ö‡¶∞‡¶´‡ßç‡¶Ø‡¶æ‡¶∂‡¶®",
                union: "‡¶ö‡¶∞ ‡¶ï‡¶≤‡¶æ‡¶™‡¶æ‡¶°‡¶º‡¶æ",
                total_requests: 45,
                mental_health_requests: 28,
                physical_health_requests: 12,
                emergency_requests: 5,
                avg_response_time_hours: 24
            },
            {
                upazila: "‡¶ö‡¶∞‡¶´‡ßç‡¶Ø‡¶æ‡¶∂‡¶®",
                union: "‡¶ö‡¶∞‡¶´‡ßç‡¶Ø‡¶æ‡¶∂‡¶® ‡¶∏‡¶¶‡¶∞",
                total_requests: 32,
                mental_health_requests: 15,
                physical_health_requests: 14,
                emergency_requests: 3,
                avg_response_time_hours: 18
            },
            {
                upazila: "‡¶ö‡¶∞‡¶´‡ßç‡¶Ø‡¶æ‡¶∂‡¶®",
                union: "‡¶®‡¶õ‡¶∞‡¶§‡¶™‡ßÅ‡¶∞",
                total_requests: 12,
                mental_health_requests: 8,
                physical_health_requests: 3,
                emergency_requests: 1,
                avg_response_time_hours: 36
            }
        ]
    },
    trends: {
        monthly_usage: [
            { month: "‡¶ú‡¶æ‡¶®‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø", checkins: 156, requests: 8 },
            { month: "‡¶´‡ßá‡¶¨‡ßç‡¶∞‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø", checkins: 189, requests: 12 },
            { month: "‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö", checkins: 234, requests: 15 },
            { month: "‡¶è‡¶™‡ßç‡¶∞‡¶ø‡¶≤", checkins: 278, requests: 18 },
            { month: "‡¶Æ‡ßá", checkins: 245, requests: 22 },
            { month: "‡¶ú‡ßÅ‡¶®", checkins: 267, requests: 14 }
        ],
        seasonal_trends: {
            monsoon: { dengue_awareness: 89, mental_health: 45 },
            winter: { flu_awareness: 67, mental_health: 38 },
            summer: { heat_stroke: 34, dehydration: 56 }
        },
        feature_popularity: {
            mood_tracker: 1247,
            health_map: 892,
            help_request: 89,
            health_tips: 567,
            maternal_tracker: 234,
            symptom_guide: 178
        }
    }
};

function updateStats() {
    document.getElementById('totalCheckins').textContent = sampleData.overview.total_checkins.toLocaleString();
    document.getElementById('helpRequests').textContent = sampleData.overview.help_requests.toLocaleString();
    document.getElementById('activeUsers').textContent = sampleData.overview.active_users.toLocaleString();
    document.getElementById('topContent').textContent = sampleData.overview.top_content;
}

function exportData(type) {
    let exportData;
    let filename;
    let contentType;
    
    const startDate = document.getElementById('startDate').value;
    const endDate = document.getElementById('endDate').value;
    
    // Apply date filtering if dates are selected
    let filteredData = sampleData[type];
    if (startDate && endDate) {
        filteredData = filterDataByDate(sampleData[type], startDate, endDate);
    }
    
    switch(type) {
        case 'overview':
            exportData = JSON.stringify(filteredData, null, 2);
            filename = `monbondhu_overview_${getCurrentDate()}.json`;
            contentType = 'application/json';
            break;
            
        case 'regional':
            exportData = convertToCSV(filteredData.upazila_data);
            filename = `monbondhu_regional_${getCurrentDate()}.csv`;
            contentType = 'text/csv';
            break;
            
        case 'trends':
            exportData = convertToExcelFormat(filteredData);
            filename = `monbondhu_trends_${getCurrentDate()}.json`;
            contentType = 'application/json';
            break;
    }
    
    // Show preview
    document.getElementById('dataPreview').textContent = exportData;
    
    // Create download
    const blob = new Blob([exportData], { type: contentType });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);
    
    // Show success message
    showMessage(`‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ${filename}`, 'success');
}

function filterDataByDate(data, startDate, endDate) {
    // In a real app, this would filter actual date-based data
    // For demo, we'll just return the data with a filter note
    return {
        ...data,
        date_range: {
            start: startDate,
            end: endDate,
            note: "‡¶°‡ßá‡¶ü‡¶æ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ range ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá"
        }
    };
}

function convertToCSV(data) {
    if (!data || data.length === 0) return '';
    
    const headers = Object.keys(data[0]);
    const csvRows = [];
    
    // Add headers
    csvRows.push(headers.join(','));
    
    // Add data rows
    for (const row of data) {
        const values = headers.map(header => {
            const value = row[header];
            return typeof value === 'string' && value.includes(',') ? `"${value}"` : value;
        });
        csvRows.push(values.join(','));
    }
    
    return csvRows.join('\n');
}

function convertToExcelFormat(data) {
    // For demo purposes, we'll return JSON that can be imported to Excel
    return JSON.stringify(data, null, 2);
}

function getCurrentDate() {
    return new Date().toISOString().split('T')[0];
}

function applyDateRange() {
    const startDate = document.getElementById('startDate').value;
    const endDate = document.getElementById('endDate').value;
    
    if (startDate && endDate) {
        showMessage(`‡¶°‡ßá‡¶ü‡¶æ ${startDate} ‡¶•‡ßá‡¶ï‡ßá ${endDate} ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`, 'info');
    } else {
        showMessage('‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶è‡¶¨‡¶Ç ‡¶∂‡ßá‡¶∑ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶â‡¶≠‡¶Ø‡¶º‡¶á ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®', 'warning');
    }
}

function showMessage(message, type) {
    // Create message element
    const messageEl = document.createElement('div');
    messageEl.textContent = message;
    messageEl.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 1rem 1.5rem;
        border-radius: 8px;
        color: white;
        font-weight: bold;
        z-index: 10000;
        animation: slideIn 0.3s ease-out;
    `;
    
    if (type === 'success') {
        messageEl.style.background = '#38a169';
    } else if (type === 'warning') {
        messageEl.style.background = '#ed8936';
    } else {
        messageEl.style.background = '#667eea';
    }
    
    document.body.appendChild(messageEl);
    
    // Remove after 3 seconds
    setTimeout(() => {
        messageEl.remove();
    }, 3000);
}

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    updateStats();
    
    // Set default date range to last 30 days
    const endDate = new Date();
    const startDate = new Date();
    startDate.setDate(startDate.getDate() - 30);
    
    document.getElementById('startDate').value = startDate.toISOString().split('T')[0];
    document.getElementById('endDate').value = endDate.toISOString().split('T')[0];
});

// Add some CSS for the message animation
const style = document.createElement('style');
style.textContent = `
    @keyframes slideIn {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
`;
document.head.appendChild(style);
</script>
{% endblock %}